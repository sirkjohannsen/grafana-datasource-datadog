{"version":3,"sources":["../../src/dfunc.js"],"names":["index","categories","Arithmatic","Interpolation","Timeshift","Rate","Smoothing","Rollup","Rank","Count","Regression","Algorithms","addFuncDef","funcDef","params","defaultParams","append","category","push","name","type","options","optional","each","funcList","catName","sortBy","FuncInstance","def","withDefaultParams","slice","updateText","prototype","render","metricExp","str","parameters","map","value","unshift","funcRender","join","console","log","updateParam","strValue","splice","length","text","createFuncInstance","isString","message","getFuncDef","getCategories","foo"],"mappings":"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","file":"dfunc.js","sourcesContent":["import _ from 'lodash';\n\nvar index = [];\nvar categories = {\n  Arithmatic: [],\n  Interpolation: [],\n  Timeshift: [],\n  Rate: [],\n  Smoothing: [],\n  Rollup: [],\n  Rank: [],\n  Count: [],\n  Regression: [],\n  Algorithms: []\n};\n\nfunction addFuncDef(funcDef) {\n  funcDef.params = funcDef.params || [];\n  funcDef.defaultParams = funcDef.defaultParams || [];\n  funcDef.append = funcDef.append || false;\n  if (funcDef.category) {\n    funcDef.category.push(funcDef);\n  }\n  index[funcDef.name] = funcDef;\n  index[funcDef.name] = funcDef;\n}\n\naddFuncDef({\n  name: 'abs',\n  category: categories.Arithmatic,\n});\n\naddFuncDef({\n  name: 'log2',\n  category: categories.Arithmatic,\n});\n\naddFuncDef({\n  name: 'cumsum',\n  category: categories.Arithmatic,\n});\n\naddFuncDef({\n  name: 'integral',\n  category: categories.Arithmatic,\n});\n\naddFuncDef({\n  name: 'fill',\n  category: categories.Interpolation,\n  params: [\n    { name: \"fill\", type: 'string', options: ['null', 'zero', 'linear', 'last'] },\n    { name: \"limit\", type: 'int', optional: true},\n  ],\n  defaultParams: ['zero'],\n  append: true,\n});\n\naddFuncDef({\n  name: 'hour_before',\n  category: categories.Timeshift,\n});\n\naddFuncDef({\n  name: 'day_before',\n  category: categories.Timeshift,\n});\n\naddFuncDef({\n  name: 'week_before',\n  category: categories.Timeshift,\n});\n\naddFuncDef({\n  name: 'month_before',\n  category: categories.Timeshift,\n});\n\naddFuncDef({\n  name: 'per_second',\n  category: categories.Rate,\n});\n\naddFuncDef({\n  name: 'per_minute',\n  category: categories.Rate,\n});\n\naddFuncDef({\n  name: 'per_hour',\n  category: categories.Rate,\n});\n\naddFuncDef({\n  name: 'dt',\n  category: categories.Rate,\n});\n\naddFuncDef({\n  name: 'diff',\n  category: categories.Rate,\n});\n\naddFuncDef({\n  name: 'derivative',\n  category: categories.Rate,\n});\n\naddFuncDef({\n  name: 'ewma_3',\n  category: categories.Smoothing,\n});\n\naddFuncDef({\n  name: 'ewma_5',\n  category: categories.Smoothing,\n});\n\naddFuncDef({\n  name: 'ewma_10',\n  category: categories.Smoothing,\n});\n\naddFuncDef({\n  name: 'ewma_20',\n  category: categories.Smoothing,\n});\n\naddFuncDef({\n  name: 'median_3',\n  category: categories.Smoothing,\n});\n\naddFuncDef({\n  name: 'median_5',\n  category: categories.Smoothing,\n});\n\naddFuncDef({\n  name: 'median_7',\n  category: categories.Smoothing,\n});\n\naddFuncDef({\n  name: 'median_9',\n  category: categories.Smoothing,\n});\n\naddFuncDef({\n  name: 'rollup',\n  category: categories.Rollup,\n  params: [\n    { name: \"rollup\", type: 'string', options: ['sum', 'avg', 'min', 'max'] },\n    { name: \"period\", type: 'int'},\n  ],\n  defaultParams: ['sum', 600],\n  append: true\n});\n\naddFuncDef({\n  name: 'count_nonzero',\n  category: categories.Count,\n});\n\naddFuncDef({\n  name: 'count_not_null',\n  category: categories.Count,\n});\n\naddFuncDef({\n  name: 'top',\n  category: categories.Rank,\n  params: [\n    { name: \"top\", type: 'int', options: [5, 10, 15]},\n    { name: \"aggr\", type: 'string', options: ['mean', 'min', 'max', 'area', 'l2norm', 'last']},\n    { name: \"dir\", type: 'string', options: ['asc', 'desc']},\n  ],\n  defaultParams: [5, 'mean', 'dir'],\n});\n\naddFuncDef({\n  name: 'robust_trend',\n  category: categories.Regression,\n});\n\naddFuncDef({\n  name: 'piecewise_constant',\n  category: categories.Regression,\n});\n\naddFuncDef({\n  name: 'anomalies',\n  category: categories.Algorithms,\n  params: [\n    { name: \"anomalies\", type: 'string', options: ['basic', 'agile', 'robust', 'adaptive']},\n    { name: \"bonds\", type: 'int', options: [1, 2, 3, 4, 5, 6]},\n  ],\n  defaultParams: ['basic', 2],\n});\n\naddFuncDef({\n  name: 'anomalies',\n  category: categories.Algorithms,\n  params: [\n    { name: \"anomalies\", type: 'string', options: ['basic', 'agile', 'robust', 'adaptive']},\n    { name: \"bonds\", type: 'int', options: [1, 2, 3, 4, 5, 6]},\n  ],\n  defaultParams: ['basic', 2],\n});\n\naddFuncDef({\n  name: 'outliers',\n  category: categories.Algorithms,\n  params: [\n    { name: \"outliers\", type: 'string', options: ['DBSCAN', 'MAD', 'scaledDBSCAN', 'scaledMAD']},\n    { name: \"tolerance\", type: 'int', options: [\n      0.33,\n      0.5,\n      1,\n      1.5,\n      2.0,\n      2.5,\n      3.0,\n      3.5,\n      4.0,\n      4.5,\n      5.0]},\n  ],\n  defaultParams: ['basic', 2],\n});\n\n_.each(categories, function(funcList, catName) {\n  categories[catName] = _.sortBy(funcList, 'name');\n});\n\nfunction FuncInstance(funcDef, options) {\n  this.def = funcDef;\n  this.params = [];\n\n  if (options && options.withDefaultParams) {\n    this.params = funcDef.defaultParams.slice(0);\n  }\n\n  this.updateText();\n}\n\nFuncInstance.prototype.render = function(metricExp) {\n  var str = this.def.name + '(';\n  var parameters = _.map(this.params, function(value) {\n    return value;\n  });\n  if (metricExp && !this.def.append) {\n    parameters.unshift(metricExp);\n  }\n\n  var funcRender = str + parameters.join(', ') + ')';\n  console.log(funcRender, this.def.append);\n  if (this.def.append) {\n    return metricExp + '.' + funcRender;\n  } else {\n    return funcRender;\n  }\n};\n\nFuncInstance.prototype.updateParam = function(strValue, index) {\n  // handle optional parameters\n  // if string contains ',' and next param is optional, split and update both\n\n  if (strValue === '' && this.def.params[index].optional) {\n    this.params.splice(index, 1);\n  }\n  else {\n    this.params[index] = strValue;\n  }\n\n  this.updateText();\n};\n\nFuncInstance.prototype.updateText = function () {\n  if (this.params.length === 0) {\n    this.text = this.def.name + '()';\n    return;\n  }\n\n  var text = this.def.name + '(';\n  text += this.params.join(', ');\n  text += ')';\n  this.text = text;\n};\n\nvar createFuncInstance = function(funcDef, options) {\n  if (_.isString(funcDef)) {\n    if (!index[funcDef]) {\n      throw { message: 'Method not found ' + name };\n    }\n    funcDef = index[funcDef];\n  }\n  return new FuncInstance(funcDef, options);\n};\n\nvar getFuncDef = function(name) {\n  return index[name];\n};\n\nvar getCategories = function() {\n  return categories;\n};\n\nvar foo;\n\nexport default foo = {\n  createFuncInstance: createFuncInstance,\n  getFuncDef: getFuncDef,\n  getCategories: getCategories,\n};\n\n"]}